<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Virtual Tour ‚Äì Dijk van een Wijf</title>
  <style>
    /* Full-screen background & center layout */
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: url('background.jpg') center/cover no-repeat fixed;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Circular Std', sans-serif;
      position: relative; overflow: hidden;
    }
    /* Wordmark (logo) at top-right (respect safe-area) */
    #wordmark {
      position: fixed;
      top: calc(env(safe-area-inset-top, 0px) + 20px);
      right: 20px;
      width: 200px; opacity: 0.9; z-index: 20;
    }
    /* Welcome overlay text */
    #welcomeOverlay {
      position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
      color: #fff;
      text-align: center;
      padding: 0 2rem;
      z-index: 19;
      pointer-events: none;
      opacity: 1;
      text-shadow: 0 0 6px rgba(0,0,0,0.5);
      transition: opacity 0.5s ease;
    }
    #welcomeOverlay h1 {
      font: 700 1.5rem 'Circular Std', sans-serif;
      margin: 0 0 0.5em;
    }
    #welcomeOverlay p {
      font: 400 1rem 'Circular Std', sans-serif;
      margin: 0;
    }
    /* Start Tour buttons at bottom-center (with safe-area) */
    #startOptions {
      position: absolute;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 4rem);
      left: 50%; transform: translateX(-50%);
      display: flex; flex-direction: column; align-items: center; gap: 1rem;
      z-index: 20;
      transition: opacity 0.5s ease;
    }
    #startOptions button {
      width: 80vw; max-width: 12rem;
      padding: 1em;
      background: rgba(255,255,255,0.6);
      color: #1D1D1B;
      border: 2px solid #EE7440;
      border-radius: 32px;
      font: 700 1rem/1.2 'Circular Std', sans-serif;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    #startOptions button:hover {
      background: rgba(238,116,64,0.8);
      transform: scale(1.05);
    }
    #startOptions button:active {
      background: #EE7440;
      color: #fff;
    }
    #startOptions.hidden { display: none; }
    /* Fade-out effect */
    #startOptions.fadeOut, #welcomeOverlay.fadeOut {
      opacity: 0;
    }
    /* Main content: widget + volume slider container */
    #mainContent {
      display: flex; flex-direction: column; align-items: center; gap: 1rem;
      z-index: 10;
    }
    /* Widget container */
    #widgetContainer {
      width: 90vw; max-width: 600px;
    }
    /* Volume slider container (styled like buttons) */
    #volumeControl {
      width: 90vw; max-width: 600px;
      padding: 0.5em 1em;
      background: rgba(255,255,255,0.6);
      border: 2px solid #EE7440;
      border-radius: 32px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    #volumeControl.hidden { display: none; }
    #volumeControl.show { opacity: 1; }
    /* Volume slider input styling */
    #volumeSlider {
      width: 100%;
      -webkit-appearance: none; appearance: none;
      height: 6px;
      background: rgba(255,255,255,0.5);
      outline: none;
      border-radius: 3px;
      cursor: pointer;
    }
    /* Track (WebKit) */
    #volumeSlider::-webkit-slider-runnable-track {
      width: 100%; height: 6px;
      background: rgba(255,255,255,0.5);
      border-radius: 3px;
    }
    /* Track (Firefox) */
    #volumeSlider::-moz-range-track {
      width: 100%; height: 6px;
      background: rgba(255,255,255,0.5);
      border-radius: 3px;
    }
    /* Thumb (WebKit) */
    #volumeSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px; height: 20px;
      background: #EE7440;
      border: 2px solid #FFF;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      cursor: pointer;
      margin-top: -7px; /* Center thumb on track */
    }
    /* Thumb (Firefox) */
    #volumeSlider::-moz-range-thumb {
      width: 20px; height: 20px;
      background: #EE7440;
      border: 2px solid #FFF;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      cursor: pointer;
    }
    /* Responsive adjustments */
    @media (max-width: 600px) {
      #startOptions { bottom: calc(env(safe-area-inset-bottom, 0px) + 3rem); }
      #startOptions button { width: 90vw; font-size: 0.9rem; }
      #widgetContainer { width: 95vw; }
      #volumeControl { width: 95vw; padding: 0.5em 0.8em; }
      #welcomeOverlay { padding: 0 1rem; }
      #welcomeOverlay h1 { font-size: 1.25rem; }
      #welcomeOverlay p { font-size: 0.9rem; }
    }
    #welcomeOverlay.hidden { display: none; }
  </style>
</head>
<body>
  <img id="wordmark" src="Dijk_van_een_Wijf_Logo.png" alt="Dijk van een Wijf">
  <!-- Welcome Message Overlay -->
  <div id="welcomeOverlay">
    <h1>Welcome to Dijk van een Wijf</h1>
    <p>For the best experience, please use headphones and turn your sound on.</p>
  </div>
  <!-- Start Tour Buttons (Language Selection) -->
  <div id="startOptions">
    <button data-agent="agent_01jykbe73efcma2nva2xmhzqfh">Start Tour<br>English üá¨üáß</button>
    <button data-agent="agent_01jxj6kx8cezesfxrsdxcjxx30">Start Tour<br>Dutch üá≥üá±</button>
    <button data-agent="agent_FRIESIAN_ID">Start Tour<br>Friesian üêö</button>
  </div>
  <!-- Main Content: widget container + volume slider -->
  <div id="mainContent">
    <div id="widgetContainer"></div>
    <div id="volumeControl" class="hidden">
      <input type="range" id="volumeSlider" min="0" max="100" value="100" />
    </div>
  </div>
  <!-- Audio element for background soundscape -->
  <audio id="bgAudio" loop preload="auto"></audio>
  <!-- ElevenLabs ConvAI Widget script -->
  <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async></script>
  <script>
    const tracks = [
      'Soundscapes - Lente - Dijk van een Wijf V2.mp3',
      'Soundscapes - Zommer - Dijk van een Wijf V2.mp3',
      'Soundscapes - Herfst - Dijk van een Wijf V2.mp3',
      'Soundscapes - Winter - Dijk van een Wijf V2.mp3'
    ];
    let currentTrack = 0;
    const bgAudio = document.getElementById('bgAudio');
    let audioCtx, gainNode;
    // Load and play current track, then on end cycle to next
    function playTrack(idx) {
      bgAudio.src = tracks[idx];
      bgAudio.load();
      bgAudio.play();
    }
    bgAudio.addEventListener('ended', () => {
      currentTrack = (currentTrack + 1) % tracks.length;
      playTrack(currentTrack);
    });
    const startOptions   = document.getElementById('startOptions');
    const widgetContainer = document.getElementById('widgetContainer');
    const volumeControl  = document.getElementById('volumeControl');
    const volumeSlider   = document.getElementById('volumeSlider');
    const welcomeOverlay = document.getElementById('welcomeOverlay');
    // Enhance the ConvAI widget appearance (glassmorphic styling, auto-begin)
    function enhanceWidget(alpha = 0.6) {
      const iv = setInterval(() => {
        const iframe = document.querySelector('iframe');
        if (!iframe) return;
        try {
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          const pane = doc.querySelector('[class*="Container"]');
          const btn = doc.querySelector('button');
          if (pane) {
            pane.style.backdropFilter = 'blur(8px)';
            pane.style.background = `rgba(255,255,255,${alpha})`;
          }
          if (btn && btn.innerText.toLowerCase().includes('begin')) {
            btn.click();
            clearInterval(iv);
          }
        } catch (e) { /* ignore cross-domain errors */ }
      }, 200);
    }
    // Update slider background fill (orange portion matches volume)
    function updateVolumeSliderBG() {
      const val = volumeSlider.value;
      volumeSlider.style.background =
        `linear-gradient(to right, #EE7440 0%, #EE7440 ${val}%, rgba(255,255,255,0.5) ${val}%, rgba(255,255,255,0.5) 100%)`;
    }
    volumeSlider.addEventListener('input', () => {
      if (gainNode) {
        gainNode.gain.value = volumeSlider.value / 100;
      }
      updateVolumeSliderBG();
    });
    // Handle language selection button clicks
    startOptions.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', () => {
        // Flash button (feedback)
        button.style.background = '#EE7440';
        button.style.color = '#fff';
        // Set up audio context and gain for volume control (iOS Safari workaround)
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          gainNode = audioCtx.createGain();
          const source = audioCtx.createMediaElementSource(bgAudio);
          source.connect(gainNode);
          gainNode.connect(audioCtx.destination);
          if (audioCtx.state === 'suspended') {
            audioCtx.resume();
          }
        }
        // Start background soundscape if not already playing
        if (bgAudio.paused) {
          currentTrack = 0;
          playTrack(currentTrack);
        }
        // Fade out welcome overlay and language buttons
        setTimeout(() => {
          startOptions.style.pointerEvents = 'none';
          welcomeOverlay.classList.add('fadeOut');
          startOptions.classList.add('fadeOut');
        }, 100);
        // After fade animation, hide start options and show main content
        setTimeout(() => {
          startOptions.classList.add('hidden');
          welcomeOverlay.classList.add('hidden');
          // Load the selected language ConvAI widget
          widgetContainer.innerHTML =
            `<elevenlabs-convai agent-id="${button.dataset.agent}"></elevenlabs-convai>`;
          // Show volume slider (smooth reveal)
          volumeControl.classList.remove('hidden');
          requestAnimationFrame(() => {
            volumeControl.classList.add('show');
          });
          // Initialize slider appearance and volume
          updateVolumeSliderBG();
          if (gainNode) gainNode.gain.value = volumeSlider.value / 100;
          // Enhance the ConvAI widget styling and auto-start
          enhanceWidget();
        }, 600);
      });
    });
  </script>
</body>
</html>
