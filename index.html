<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dijk van een Wijf ‚Äî Audio Tour</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Circular+Std:wght@400;700&display=swap">
  <style>
    :root {
      --orange: #EE7440;
      --black: #1D1D1B;
      --glass: rgba(255, 255, 255, 0.6);
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Circular Std', sans-serif;
      background: url('background.jpg') center/cover no-repeat fixed;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      color: var(--black);
      overflow: hidden;
    }

    #introScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      z-index: 99;
    }

    #introScreen h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    #introScreen button {
      background: var(--glass);
      border: 2px solid var(--orange);
      color: var(--black);
      border-radius: 2rem;
      padding: 1rem 2rem;
      font-weight: bold;
      font-size: 1rem;
      margin-top: 1rem;
      backdrop-filter: blur(6px);
      transition: background 0.3s, transform 0.2s;
    }

    #introScreen button:hover {
      background: var(--orange);
      color: white;
      transform: scale(1.05);
    }

    #wordmark {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 140px;
      opacity: 0.9;
      z-index: 20;
    }

    #startOptions {
      position: absolute;
      bottom: 4rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
      z-index: 20;
    }

    #startOptions button {
      width: 80vw;
      max-width: 300px;
      background: var(--glass);
      color: var(--black);
      border: 2px solid var(--orange);
      border-radius: 2rem;
      padding: 1rem;
      font-weight: 700;
      backdrop-filter: blur(6px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }

    #startOptions button:hover {
      background: var(--orange);
      color: white;
      transform: scale(1.05);
    }

    #mainContent {
      margin-top: auto;
      padding-bottom: 3rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      z-index: 10;
    }

    #widgetContainer, #muteBar, #volumeControl {
      width: 90vw;
      max-width: 600px;
      background: var(--glass);
      border: 2px solid var(--orange);
      border-radius: 2rem;
      padding: 1rem;
      backdrop-filter: blur(6px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    #muteBar, #volumeControl {
      text-align: center;
      font-weight: bold;
      cursor: pointer;
    }

    #volumeSlider {
      width: 100%;
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="introScreen">
    <h1>Welcome to Dijk van een Wijf</h1>
    <p>For the best experience, use headphones and enable sound.</p>
    <button onclick="startApp()">Begin</button>
  </div>

  <img id="wordmark" src="Dijk_van_een_Wijf_Logo.png" alt="Wordmark">

  <div id="startOptions" class="hidden">
    <button data-agent="agent_01jykbe73efcma2nva2xmhzqfh">Start Tour ‚Äì English üá¨üáß</button>
    <button data-agent="agent_01jxj6kx8cezesfxrsdxcjxx30">Start Tour ‚Äì Dutch üá≥üá±</button>
    <button data-agent="agent_FRIESIAN_ID">Start Tour ‚Äì Friesian üêö</button>
  </div>

  <div id="mainContent">
    <div id="widgetContainer"></div>
    <button id="muteBar" class="hidden">Mute Music</button>
    <div id="volumeControl" class="hidden">
      <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1">
    </div>
  </div>

  <audio id="bgAudio" loop preload="auto"></audio>

  <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async></script>
  <script>
    const bgAudio = document.getElementById('bgAudio');
    const tracks = [
      'Soundscapes - Lente - Dijk van een Wijf V2.mp3',
      'Soundscapes - Zommer - Dijk van een Wijf V2.mp3',
      'Soundscapes - Herfst - Dijk van een Wijf V2.mp3',
      'Soundscapes - Winter - Dijk van een Wijf V2.mp3'
    ];
    let currentTrack = 0;

    function playTrack(idx) {
      bgAudio.src = tracks[idx];
      bgAudio.load();
      bgAudio.play();
    }

    bgAudio.addEventListener('ended', () => {
      currentTrack = (currentTrack + 1) % tracks.length;
      playTrack(currentTrack);
    });

    const startOptions = document.getElementById('startOptions');
    const muteBar = document.getElementById('muteBar');
    const volumeControl = document.getElementById('volumeControl');
    const volumeSlider = document.getElementById('volumeSlider');
    const widgetContainer = document.getElementById('widgetContainer');

    volumeSlider.addEventListener('input', () => {
      bgAudio.volume = volumeSlider.value;
    });

    muteBar.addEventListener('click', () => {
      bgAudio.muted = !bgAudio.muted;
      muteBar.textContent = bgAudio.muted ? 'Unmute Music' : 'Mute Music';
    });

    startOptions.querySelectorAll('button').forEach(b => {
      b.addEventListener('click', () => {
        playTrack(currentTrack = 0);
        startOptions.classList.add('hidden');
        widgetContainer.innerHTML = `<elevenlabs-convai agent-id="${b.dataset.agent}"></elevenlabs-convai>`;
        muteBar.classList.remove('hidden');
        volumeControl.classList.remove('hidden');
        enhanceWidget();
      });
    });

    function startApp() {
      document.getElementById('introScreen').style.display = 'none';
      startOptions.classList.remove('hidden');
    }

    function enhanceWidget(alpha = 0.6) {
      const iv = setInterval(() => {
        const iframe = document.querySelector('iframe');
        if (!iframe) return;
        try {
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          const pane = doc.querySelector('[class*="Container"]');
          const btn = doc.querySelector('button');
          if (pane) {
            pane.style.backdropFilter = 'blur(8px)';
            pane.style.background = `rgba(255,255,255,${alpha})`;
          }
          if (btn && btn.innerText.toLowerCase().includes('begin')) {
            btn.click();
            clearInterval(iv);
          }
        } catch {}
      }, 200);
    }
  </script>
</body>
</html>